/*
 * This file was generated by the Gradle 'init' task.
 */

plugins {
    id 'java-library'
    id 'net.minecrell.plugin-yml.bukkit' version '0.6.0'
    id("com.gradleup.shadow") version "9.0.0-beta10"
}

repositories {
    mavenCentral()
    maven { url = uri('https://raw.githubusercontent.com/theprogmatheus/maven-repository/master/') }
    maven { url = uri('https://hub.spigotmc.org/nexus/content/repositories/snapshots/') }
    maven { url 'https://jitpack.io' }
}


dependencies {
    // Section: compileOnly
    compileOnly 'org.projectlombok:lombok:1.18.36'
    compileOnly('org.bukkit:bukkit:1.8.8-R0.1-SNAPSHOT')
    compileOnly "com.github.MilkBowl:VaultAPI:1.7.1"


    // Section: implementation
    implementation 'com.github.theprogmatheus:jgr-uchecker:1.0.0'
    implementation 'com.github.theprogmatheus.minecraft.utils:itembuilder:1.0'
    implementation 'com.github.theprogmatheus.minecraft.utils:guibuilder:1.0'
    implementation('com.j256.ormlite:ormlite-jdbc:6.1')
    implementation("com.github.ben-manes.caffeine:caffeine:3.2.0")
    implementation 'org.postgresql:postgresql:42.7.5'
    implementation 'org.mariadb.jdbc:mariadb-java-client:3.5.2'


    // Section: annotationProcessor
    annotationProcessor 'org.projectlombok:lombok:1.18.36'
}

def getGitHash() {
    try {
        def stdout = new ByteArrayOutputStream()
        exec {
            commandLine 'git', 'rev-parse', '--short', 'HEAD'
            standardOutput = stdout
            ignoreExitValue = true
        }
        return stdout.toString().trim() ?: "dev"
    } catch (Exception e) {
        return "dev"
    }
}

group = 'com.redeskyller.bukkit.solaryeconomy'
version = '2.0.0'
description = 'An economy plugin for Bukkit server'

java.sourceCompatibility = JavaVersion.VERSION_11

def buildVersion = project.hasProperty("release") ? project.version : "${project.version}-${getGitHash()}"

bukkit {
    name = 'Solary-Economy'
    main = 'com.github.theprogmatheus.mc.solaryeconomy.SolaryEconomy'
    version = buildVersion
    description = project.description
    authors = ['Sr_Edition', 'theprogmatheus']
    website = 'https://github.com/theprogmatheus/Solary-Economy'
    apiVersion = '1.8'
    depend = ['Vault']
    load = 'STARTUP'
}


shadowJar {
    archiveBaseName.set(bukkit.name)
    archiveVersion.set(buildVersion)
    archiveClassifier.set("")


    relocate 'com.github.theprogmatheus.util', 'com.github.theprogmatheus.mc.solaryeconomy.lib'
    relocate 'com.github.theprogmatheus.minecraft.utils', 'com.github.theprogmatheus.mc.solaryeconomy.lib'
    relocate 'com.j256.ormlite', 'com.github.theprogmatheus.mc.solaryeconomy.lib.j256.ormlite'
    relocate 'com.github.benmanes.caffeine', 'com.github.theprogmatheus.mc.solaryeconomy.lib.benmanes.caffeine'
}
tasks.withType(JavaCompile).configureEach {
    options.encoding = 'UTF-8'
}

tasks.withType(Jar).configureEach {
    manifest.attributes('Charset': 'UTF-8')
}
tasks.build.dependsOn('shadowJar')